# Retrieval Metadata Example

## Purpose

This document explains the `example-retrieval-metadata.json` file, which provides a comprehensive reference for the retrieval metadata structure generated by the financial research skill.

The example demonstrates how the skill tracks all information retrieved during a research session, including:
- Research session metadata
- Task-level organization
- Document details from each MCP tool query
- Data source statistics

## Example File: example-retrieval-metadata.json

The example file shows a complete retrieval metadata structure for a Tesla company analysis research session with 5 tasks and 12 files retrieved.

### Key Features Demonstrated

#### 1. Research Session Metadata
```json
{
  "research_session": {
    "topic": "特斯拉公司深度分析",
    "research_type": "company_analysis",
    "timestamp": "2026-02-06T15:30:00Z",
    "total_tasks": 5,
    "total_files_retrieved": 12
  }
}
```

**Fields:**
- `topic`: Research topic (in Chinese, matching user input)
- `research_type`: Type of research (e.g., "company_analysis", "industry_analysis")
- `timestamp`: ISO 8601 format timestamp
- `total_tasks`: Number of tasks in the plan
- `total_files_retrieved`: Total documents retrieved across all tasks

#### 2. Task-Level Organization

Each task in the `tasks` array includes:
```json
{
  "task_id": "1",
  "task_name": "获取特斯拉基本信息和最新动态",
  "files": [...]
}
```

**Features:**
- Tasks are ordered by task_id (matches plan execution order)
- Task names are descriptive (in Chinese)
- Some tasks have multiple files, some have none (depending on execution)

#### 3. Qualitative Data: Research Reports, News, Summaries

Example from `info_search_finance_db`:
```json
{
  "file_id": "20240215001",
  "title": "特斯拉(TSLA.US)2023年度业绩点评:Model Y销量创新高,自动驾驶技术领先",
  "publish_date": "2024-02-15",
  "type_full_name": "公司研究-深度报告",
  "institution_name": "中信证券",
  "company_name": "特斯拉",
  "section": "特斯拉2023年全年交付量达到180万辆...",
  "data_source": "info_search_finance_db",
  "query": "特斯拉 最新研报"
}
```

**Key characteristics:**
- Real file_id (e.g., "20240215001")
- Complete metadata: title, publish_date, type, institution, company
- Extracted content in `section` field
- Source tool: `info_search_finance_db`
- Original search query preserved

#### 4. Quantitative Data: Stock Database

Example from `info_search_stock_db`:
```json
{
  "file_id": "N/A",
  "title": "特斯拉2023年关键财务指标",
  "publish_date": "2024-01-25",
  "type_full_name": "量化数据",
  "institution_name": "N/A",
  "company_name": "特斯拉",
  "section": "2023年全年营收967亿美元,同比增长19%;净利润150亿美元...",
  "data_source": "info_search_stock_db",
  "query": "特斯拉2023年营收、净利润、毛利率、研发费用"
}
```

**Key characteristics:**
- file_id is "N/A" (quantitative data doesn't have file IDs)
- type_full_name is "量化数据" (quantitative data)
- institution_name is "N/A" (data comes from database, not a report)
- Numerical data and calculations in `section` field
- Source tool: `info_search_stock_db`

#### 5. Data Source Summary

```json
{
  "data_source_summary": {
    "info_search_finance_db": 9,
    "info_search_user_db": 0,
    "info_search_stock_db": 2,
    "info_search_web": 0
  }
}
```

**Features:**
- Counts for all 4 MCP tools (even if 0)
- Helps understand research data mix
- Useful for analytics and optimization

## Use Cases

### 1. Downstream System Integration

The metadata file enables downstream systems to:
- **Generate references sections** with proper citations
- **Track data lineage** for compliance and auditing
- **Build knowledge graphs** connecting companies, reports, and analysts
- **Create analytics dashboards** showing research patterns
- **Implement caching strategies** based on file_id and query patterns

### 2. Quality Assurance

Use the metadata to:
- Verify all planned tasks retrieved information
- Check diversity of data sources (qualitative vs quantitative)
- Validate date ranges of retrieved documents
- Ensure proper attribution to institutions

### 3. User Transparency

Share with users to show:
- Exactly which reports and data were consulted
- Date ranges of information used
- Breadth of research sources
- Data freshness

### 4. Research Analytics

Analyze patterns:
- Most frequently queried companies
- Popular research topics
- Institution coverage
- Temporal trends in data retrieval

## File Structure Validation

The example file has been validated for:
- ✅ Valid JSON syntax
- ✅ Complete research_session object
- ✅ Properly structured tasks array
- ✅ All required fields in file objects
- ✅ Correct data_source values
- ✅ Proper use of "N/A" for quantitative data
- ✅ All 4 MCP tools in summary (even if 0)
- ✅ Chinese text for realistic content
- ✅ ISO 8601 timestamp format

## Integration Example

Here's how a downstream system might use this metadata:

```python
import json

# Load metadata
with open('retrieval-metadata.json', 'r', encoding='utf-8') as f:
    metadata = json.load(f)

# Generate references section
references = []
for task in metadata['tasks']:
    for file in task['files']:
        if file['file_id'] != 'N/A':  # Skip quantitative data
            ref = f"{file['institution_name']}. {file['title']}. {file['publish_date']}"
            references.append(ref)

# Create data source breakdown
sources = metadata['data_source_summary']
print(f"Research used {sources['info_search_finance_db']} reports, "
      f"{sources['info_search_stock_db']} quantitative queries")

# Find all companies researched
companies = set()
for task in metadata['tasks']:
    for file in task['files']:
        if file['company_name']:
            companies.add(file['company_name'])
```

## Best Practices

When implementing systems that consume this metadata:

1. **Handle both file_id types**: Real IDs for reports, "N/A" for quantitative data
2. **Preserve original queries**: Useful for caching and query optimization
3. **Respect Chinese encoding**: Use UTF-8 throughout your pipeline
4. **Validate data_source values**: Only 4 valid values (see above)
5. **Use ISO 8601 for timestamps**: Ensures consistent date parsing
6. **Track all 4 tools in summary**: Even if count is 0

## Related Documentation

- [Test Cases README](./README.md) - Overview of all test cases
- [Output and Tracking Features Plan](../output-and-tracking-features.md) - Feature specification
- [Research Plan Schema](../research-plan-schema.md) - Plan structure reference

## Questions or Issues?

If you have questions about the metadata structure or need additional examples for specific use cases, please open an issue in the skills repository.
